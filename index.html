<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracy's Karate - Instructor & Student Portal</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #1a1a1a; color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px 0; }
        .container { background: #2b2b2b; padding: 40px; border-radius: 12px; border-top: 6px solid #ffcc00; box-shadow: 0 15px 35px rgba(0,0,0,0.6); text-align: center; width: 90%; max-width: 500px; }
        
        .header-container { display: flex; align-items: center; justify-content: center; margin-bottom: 20px; gap: 15px; }
        .logo { width: 60px; height: auto; border-radius: 4px; }
        h1 { color: #ffcc00; text-transform: uppercase; letter-spacing: 2px; margin: 0; font-size: 22px; }
        
        p { color: #ccc; font-size: 14px; margin-bottom: 20px; }
        .notice { background: rgba(255, 204, 0, 0.1); color: #ffcc00; padding: 15px; border-radius: 8px; border: 1px solid #ffcc00; margin-bottom: 20px; font-size: 13px; line-height: 1.4; text-align: left; }
        
        input { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #444; border-radius: 6px; background: #333; color: white; box-sizing: border-box; font-size: 16px; }
        input:focus { border-color: #ffcc00; outline: none; }
        
        button { width: 100%; padding: 14px; background: #ffcc00; color: #1a1a1a; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px; transition: 0.2s; }
        button:hover { background: #e6b800; transform: translateY(-1px); }
        
        #error { color: #ff4d4d; font-size: 14px; margin-top: 15px; display: none; }
        
        #videoContent { display: none; text-align: left; }
        .video-link { display: none; background: #333; color: #fff; padding: 18px; margin: 12px 0; text-decoration: none; border-left: 5px solid #ffcc00; border-radius: 4px; transition: 0.3s; font-weight: 600; cursor: pointer; }
        .video-link:hover { background: #444; padding-left: 25px; color: #ffcc00; }
        
        /* Video Container & Shield */
        #playerContainer { display: none; margin-bottom: 25px; }
        .close-player { background: #444; color: #ffcc00; font-size: 11px; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin-bottom: 12px; display: inline-block; font-weight: bold; border: 1px solid #555; text-transform: uppercase; }
        
        .video-wrapper { 
            position: relative; 
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0; 
            overflow: hidden; 
            border-radius: 8px; 
            border: 2px solid #ffcc00; 
            background: #000; 
        }

        /* THE SHIELD: Blocks clicks on Share/Watch Later in top corners */
        .video-shield {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 55px; /* Adjust height to cover the specific buttons */
            z-index: 10;
            background: transparent;
            cursor: default;
        }

        .video-wrapper iframe { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 5;
        }
        
        .logout-btn { background: #444; color: white; margin-top: 30px; font-size: 14px; }
    </style>
</head>
<body>

    <div class="container" id="loginBox">
        <div class="header-container">
            <img src="BLACK-TK.png" alt="Tracy's Logo" class="logo">
            <h1>Material Access</h1>
        </div>
        <p>Tracy's Karate Parma Heights</p>
        <div class="notice">
            <strong>SECURITY NOTICE:</strong> Content sharing is disabled. Access is logged by user ID.
        </div>
        <input type="email" id="emailInput" placeholder="Email Address">
        <input type="password" id="passInput" placeholder="Password">
        <button id="loginBtn">Enter Dojo</button>
        <div id="error">Invalid login credentials.</div>
    </div>

    <div class="container" id="videoContent">
        <div class="header-container">
            <img src="BLACK-TK.png" alt="Tracy's Logo" class="logo">
            <h1 id="welcomeTitle">Training Library</h1>
        </div>

        <div id="playerContainer">
            <div class="close-player" onclick="closeVideo()">âœ– Close Video</div>
            <div class="video-wrapper">
                <div class="video-shield"></div>
                <iframe id="videoPlayer" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>

        <p>Your Curriculum:</p>

        <div onclick="loadVideo('PLudsFr1QJtbLfLddHmojVO4fen7GlvEVQ')" id="rank-basics" class="video-link" style="border-left-color: #ffffff;">âš« Basics & Fundamentals</div>
        <div onclick="loadVideo('PLudsFr1QJtbK1MkX-oILTeyyq7BBxRO0G')" id="rank-yellow" class="video-link" style="border-left-color: #ffff00;">ðŸŸ¡ Yellow Belt Material</div>
        <div onclick="loadVideo('YOUR_ORANGE_ID')" id="rank-orange" class="video-link" style="border-left-color: #ff8c00;">ðŸŸ  Orange Belt Material</div>
        <div onclick="loadVideo('YOUR_PURPLE_ID')" id="rank-purple" class="video-link" style="border-left-color: #800080;">ðŸŸ£ Purple Belt Material</div>

        <button class="logout-btn" onclick="location.reload()">Log Out</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Your exact Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyC35Ubf6GxyDi3JEiKWaYgVFkYGknMZrcw",
            authDomain: "tracy-s-karate-portal.firebaseapp.com",
            projectId: "tracy-s-karate-portal",
            storageBucket: "tracy-s-karate-portal.appspot.com",
            messagingSenderId: "236877703560",
            appId: "1:236877703560:web:9a01e386b0e97dc229b23d"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const loginBtn = document.getElementById('loginBtn');
        const errorMsg = document.getElementById('error');

        loginBtn.addEventListener('click', async () => {
            const email = document.getElementById('emailInput').value;
            const pass = document.getElementById('passInput').value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, pass);
                const userDoc = await getDoc(doc(db, "users", userCredential.user.uid));
                
                if (userDoc.exists()) {
                    showPortal(userDoc.data());
                } else {
                    alert("Account found, but no rank assigned in Firestore. Document ID must match UID.");
                }
            } catch (e) {
                errorMsg.style.display = 'block';
            }
        });

        function showPortal(userData) {
            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('videoContent').style.display = 'block';
            document.getElementById('welcomeTitle').innerText = "WELCOME, " + (userData.name || "STUDENT").toUpperCase();

            document.getElementById('rank-basics').style.display = 'block';
            const userRank = userData.rank ? userData.rank.toLowerCase() : '';

            if (userRank === 'instructor') {
                document.querySelectorAll('.video-link').forEach(link => link.style.display = 'block');
            } else if (userRank) {
                const specificRank = document.getElementById('rank-' + userRank);
                if (specificRank) specificRank.style.display = 'block';
            }
        }

        window.loadVideo = function(playlistId) {
            const player = document.getElementById('videoPlayer');
            const container = document.getElementById('playerContainer');
            
            // Parameters:
            // modestbranding=1 (removes logo)
            // rel=0 (related videos from same channel only)
            // iv_load_policy=3 (hides annotations)
            player.src = `https://www.youtube.com/embed/videoseries?list=${playlistId}&modestbranding=1&rel=0&iv_load_policy=3&controls=1`;
            
            container.style.display = 'block';
            container.scrollIntoView({ behavior: 'smooth' });
        };

        window.closeVideo = function() {
            document.getElementById('videoPlayer').src = ""; 
            document.getElementById('playerContainer').style.display = 'none';
        };
    </script>
</body>
</html>
